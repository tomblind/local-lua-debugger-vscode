# Local Lua Debugger for Visual Studio Code

A simple Lua debugger for Visual Studio Code which requires no external dependencies.

---
## Features
- Debug Lua in any environment that supports communication via stdio (such as the stand-alone Lua interpreter)
- Supports Lua versions 5.1, 5.2, 5.3 and [LuaJit](https://luajit.org/)
- Basic debugging features (stepping, inspecting, breakpoints, etc...)
- Conditional breakpoints
- Debug coroutines as separate threads
- Basic support for source maps, such as those generated by [TypescriptToLua](https://typescripttolua.github.io/)

---
## Usage

### Lua Stand-Alone Interpreter
To debug a Lua program using the stand-alone interpreter, set up your `launch.json` with the name/path of the interpreter, and the file you wish to pass to it:
```json
{
  "configurations": [
    {
      "type": "lua-local",
      "request": "launch",
      "name": "Debug",
      "launch": {
        "lua": "lua5.1",
        "file": "main.lua"
      }
    }
  ]
}
```

### Custom Lua Environment
To debug using a custom Lua environment, you must set up your `launch.json` with the name/path of the executable and any additional arguments that may be needed.
```json
{
  "type": "lua-local",
  "request": "launch",
  "name": "Debug Love",
  "launch": {
    "executable": "love",
    "args": [
      "${workspaceFolder}"
    ]
  }
}
```
You must then manually start the debugger in your code:
```lua
require("lldebugger").start()
```
Note that the path to `lldebugger` will automatically be appended to the `LUA_PATH` environment variable, so it can be found by Lua.

---
## Requirements & Limitations
- The Lua environment must support communication via stdio.
  - Some enviroments may require command line options to support this.
  - Ex. the Corona Simulator requires the `/no-console` flag.
- The Lua environment must be built with the `debug` library, and no other code should attempt to set debug hooks.
- You cannot pause debugging while the program is running.
- In Lua 5.1 and LuaJit, the main thread cannot be accessed while stopped inside of a coroutine.
- Most custom enviroments do not support breaking on runtime errors.
  - The debugger *will* break on explicit calls to `error()` and `assert()`.
  - To debug a runtime error, you can wrap the code with `lldebugger.call()`:
    ```lua
    require("lldebugger").call(function()
      --code to debug
    end)
    ```

---
## Tips
- You can detect that the debugger extension is attached by inspecting the environment variable `LOCAL_LUA_DEBUGGER_VSCODE`. This is useful for conditionally starting the debugger.
    ```lua
    if os.getenv("LOCAL_LUA_DEBUGGER_VSCODE") == "1" then
      require("lldebugger").start()
    end
    ```
